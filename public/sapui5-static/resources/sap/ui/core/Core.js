/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.core.Core");jQuery.sap.require("jquery.sap.dom");jQuery.sap.require("jquery.sap.events");jQuery.sap.require("jquery.sap.properties");jQuery.sap.require("jquery.sap.resources");jQuery.sap.require("jquery.sap.script");jQuery.sap.require("sap.ui.Global");jQuery.sap.require("sap.ui.base.EventProvider");jQuery.sap.require("sap.ui.core.Configuration");jQuery.sap.require("sap.ui.core.Control");jQuery.sap.require("sap.ui.core.FocusHandler");jQuery.sap.require("sap.ui.core.ResizeHandler");jQuery.sap.require("sap.ui.core.RenderManager");jQuery.sap.require("sap.ui.core.UIArea");
sap.ui.core.Core=function(){if(sap.ui.getCore&&sap.ui.getCore()){return sap.ui.getCore();}var t=this,l=jQuery.sap.log,M="sap.ui.core.Core";sap.ui.base.EventProvider.apply(this);this.bBooted=false;this.bInitialized=false;this.aPlugins=[];this.mLibraries={};this.mResourceBundles={};this.mUIAreas={};this.oModels={};this.mElements={};this.aInitListeners=[];this.bInitLegacyLib=false;l.info("Creating Core",null,M);this.oConfiguration=new sap.ui.core.Configuration();sap.ui.core.Element.prototype.register=function(){t.registerElement(this);};sap.ui.core.Element.prototype.deregister=function(){t.deregisterElement(this);};var a=this.oConfiguration.modules;if(this.oConfiguration.getDebug()){a.unshift("sap-ui-debug");}a.unshift("sap.ui.core.library");l.info("Declared modules: "+a,M);var c=window["sap-ui-config"];if(c){if(c.themeroots){for(var d in c.themeroots){var e=c.themeroots[d];if(typeof e==="string"){this.setThemeRoot(d,e);}else{for(var f in e){if(f.length>0){this.setThemeRoot(d,[f],e[f]);}else{this.setThemeRoot(d,e[f]);}}}}}}this.sTheme=this.oConfiguration.getTheme();jQuery(document.documentElement).addClass("sapUiTheme-"+this.sTheme);l.info("Declared theme "+this.sTheme,null,M);if(this.oConfiguration.getRTL()){jQuery(document.documentElement).attr("dir","rtl");l.info("RTL mode activated",null,M);}function g(){var b=jQuery.browser,u=navigator.userAgent,i=parseFloat(b.version);if(b.mozilla){if(u.match(/Firefox\/(\d+\.\d+)/)){i=parseFloat(RegExp.$1);b.fVersion=i;return"ff"+Math.floor(i);}}else if(b.webkit){if(u.match(/Chrome\/(\d+\.\d+).\d+/)){b.chrome=true;b.safari=false;i=parseFloat(RegExp.$1);b.fVersion=i;return"cr"+i;}else{var k=/Version\/(\d+\.\d+).\d* *Safari/;if(k.test(u)){b.safari=true;i=parseFloat(k.exec(u)[1]);b.fVersion=i;if(i>=5){return"sf5";}if(i>=4){return"sf4";}}}}else if(b.msie){if(document.documentMode){if(document.documentMode===7){l.warning("Browser running in IE7 document mode.",null,M);b.fVersion=8.0;return"ie8";}b.fVersion=parseFloat(document.documentMode);return"ie"+document.documentMode;}else{b.fVersion=i;return"ie"+i;}}}function h(u){u=u||navigator.userAgent;var p=/[(]([a-zA-TV-Z]+);\s(?:[U]?[;]?)([\D]+)((?:\d[._])+\d)/;var r=u.match(p);if(r){var b=/iPhone|iPad|iPod/;if(r[0].match(b)){r[3]=r[3].replace(/_/g,".");return({"version":'iOS'+r[3],"css":"sap-ios"})}else if(r[2].match(/Android/)){r[2]=r[2].replace(/\s/g,"");return({"version":r[2]+r[3],"css":"sap-android"})}else{return;}}}var j=g();if(j){jQuery("html").attr("data-sap-ui-browser",j);l.debug("Browser-Id: "+j,null,M);}var o=h();if(o){jQuery("html").attr("data-sap-ui-os",o.version).addClass(o.css);}if(this.oConfiguration.getWeinreId()){l.info("Starting WEINRE Remote Web Inspector");document.write("<script src=\"");document.write(this.oConfiguration.getWeinreServer()+"/target/target-script-min.js#"+this.oConfiguration.getWeinreId());document.write("\"></script>");}sap.ui.getCore=jQuery.sap.getter(this.getInterface());if(!this.oConfiguration['xx-loadAllMode']&&!this.oConfiguration['xx-preload']&&(!window.document.body||window.document.readyState)){this.boot();}sap.ui.core.RenderManager.initHTML5Support();this.oRenderManager=new sap.ui.core.RenderManager();jQuery(document).ready(jQuery.proxy(this,"handleLoad"));if(this.oConfiguration['xx-preload']){jQuery.each(a,function(i,b){var m=b.match(/^(.*)\.library$/);if(m){var p=m[1].replace(/\./g,"-")+"-preload";jQuery.sap.log.debug("preload file "+p);jQuery.ajax({dataType:"text",async:t.oConfiguration['xx-preload']!=="sync",url:jQuery.sap.getModulePath(p,".js"),success:function(k){jQuery.sap.globalEval(k);}});}});}};
sap.ui.core.Core.prototype=jQuery.sap.newObject(sap.ui.base.EventProvider.prototype);sap.ui.base.Object.defineClass("sap.ui.core.Core",{baseType:"sap.ui.base.EventProvider",publicMethods:["boot","isInitialized","attachInitEvent","getRenderManager","createRenderManager","getConfiguration","setRoot","createUIArea","getUIArea","getUIDirty","getElementById","getCurrentFocusedControlId","getControl","lock","unlock","isLocked","attachEvent","detachEvent","applyChanges","applyTheme","setThemeRoot","attachThemeChanged","detachThemeChanged","getStaticAreaRef","registerPlugin","unregisterPlugin","getLibraryResourceBundle","byId","getLoadedLibraries","attachControlEvent","detachControlEvent","loadLibrary","initLibrary","includeLibraryTheme","setModel","getModel","hasModel","isMobile","attachParseError","detachParseError","attachValidationError","detachValidationError","attachFormatError","detachFormatError","attachValidationSuccess","detachValidationSuccess","fireFormatError","fireParseError","fireValidationError","fireValidationSuccess"]});sap.ui.core.Core.M_EVENTS={ControlEvent:"ControlEvent",UIUpdated:"UIUpdated",ThemeChanged:"ThemeChanged",ValidationError:"validationError",ParseError:"parseError",FormatError:"formatError",ValidationSuccess:"validationSuccess"};
sap.ui.core.Core.prototype.boot=function(){if(this.bBooted){return;}this.bBooted=true;this.lock();var t=this;jQuery.each(this.oConfiguration.modules,function(i,a){var m=a.match(/^(.*)\.library$/);if(m){t.loadLibrary(m[1]);}else{jQuery.sap.require(a);}});this.unlock();};
sap.ui.core.Core.prototype.applyTheme=function(t,s){if(s){this.setThemeRoot(t,s);}if(t&&this.sTheme!=t){var c=this.sTheme,a=this;jQuery("link[id^=sap-ui-theme-]").each(function(){var l=this.id.substr(13);var p;if((p=l.indexOf("-["))>0){l=l.substr(0,p);}var b=a._getThemePath(l,t);var f=this.href.substr(this.href.lastIndexOf("/")+1);this.href=b+f;});this.sTheme=t;this.getConfiguration().setTheme(t);jQuery(document.documentElement).removeClass("sapUiTheme-"+c).addClass("sapUiTheme-"+t);jQuery.sap.delayedCall(500,this,"fireThemeChanged",[{theme:t}]);}};
sap.ui.core.Core.prototype._getThemePath=function(l,t){if(this._mThemeRoots){var p=this._mThemeRoots[t+" "+l]||this._mThemeRoots[t];if(p){p=p+l.replace(/\./g,"/")+"/themes/"+t+"/";jQuery.sap.registerModulePath(l+".themes."+t,p);return p;}}return jQuery.sap.getModulePath(l+".themes."+t+"/","/");};
sap.ui.core.Core.prototype.setThemeRoot=function(t,l,s){if(!this._mThemeRoots){this._mThemeRoots={};}if(!s){s=l;l=undefined;}s=s+(s.slice(-1)=="/"?"":"/");if(l){for(var i=0;i<l.length;i++){var a=l[i];this._mThemeRoots[t+" "+a]=s;}}else{this._mThemeRoots[t]=s;}};
sap.ui.core.Core.prototype.init=function(){if(this.bInitialized){return;}var a=jQuery.sap.log,M="sap.ui.core.Core.init()";this.boot();a.info("Initializing",null,M);this.oFocusHandler=new sap.ui.core.FocusHandler(document.body,this);this.oResizeHandler=new sap.ui.core.ResizeHandler(this);a.info("Initialized",null,M);this.bInitialized=true;a.info("Starting Plugins",null,M);this.startPlugins();a.info("Plugins started",null,M);var c=this.oConfiguration;if(c.areas){for(var i=0,l=c.areas.length;i<l;i++){this.createUIArea(c.areas[i]);}c.areas=undefined;}if(c.onInit){if(typeof c.onInit==="function"){c.onInit();}else{jQuery.sap.globalEval(c.onInit);}c.onInit=undefined;}if(this.aInitListeners.length>0){a.info("Fire Loaded Event",null,M);jQuery.each(this.aInitListeners,function(i,f){f();});this.aInitListeners=[];}this._rerenderAllUIAreas();};
sap.ui.core.Core.prototype.handleLoad=function(){var w=this.isLocked();if(!w){this.lock();}this.init();if(!w){this.unlock();}};
sap.ui.core.Core.prototype.isInitialized=function(){return this.bInitialized;};
sap.ui.core.Core.prototype.attachInitEvent=function(f){this.aInitListeners.push(f);};
sap.ui.core.Core.prototype.lock=function(){this.bLocked=true;};
sap.ui.core.Core.prototype.unlock=function(){this.bLocked=false;};
sap.ui.core.Core.prototype.isLocked=function(){return this.bLocked;};
sap.ui.core.Core.prototype.getConfiguration=function(){return this.oConfiguration;};
sap.ui.core.Core.prototype.getRenderManager=function(){return this.createRenderManager();};
sap.ui.core.Core.prototype.createRenderManager=function(){return(new sap.ui.core.RenderManager()).getInterface();};
sap.ui.core.Core.prototype.getCurrentFocusedControlId=function(){return this.oFocusHandler.getCurrentFocusedControlId();};
sap.ui.core.Core.prototype.loadLibrary=function(l,u){if(!this.mLibraries[l]){var m=l+".library",a;if(u){jQuery.sap.registerModulePath(l,u);}if(this.oConfiguration['xx-loadAllMode']&&!jQuery.sap.isDeclared(m)){a=l.replace(/\./g,"-")+"-all";jQuery.sap.log.debug("load all-in-one file "+a);jQuery.sap.require(a);}jQuery.sap.require(m);if(!this.mLibraries[l]){jQuery.sap.log.warning("library "+l+" didn't initialize itself");this.initLibrary(l);}}return this.mLibraries[l];};
sap.ui.core.Core.prototype.initLibrary=function(l){var b=typeof l==="string",o=b?{name:l}:l,s=o.name,a=jQuery.sap.log,M="sap.ui.core.Core.initLibrary()";if(b){a.warning("[Deprecated] library "+s+" uses old fashioned initLibrary() call (rebuild with newest generator)");}if(!s||this.mLibraries[s]){return;}a.debug("Analyzing Library "+s,null,M);this.mLibraries[s]=o=jQuery.extend({dependencies:[],types:[],interfaces:[],controls:[],elements:[]},o);function r(){var p=jQuery.sap.properties({url:sap.ui.resource(s,"library.properties")});o.version=p.getProperty(s+"[version]");var c=p.getProperty(s+"[dependencies]");a.debug("Required Libraries: "+c,null,M);o.dependencies=(c&&c.split(/[,;| ]/))||[];var k=p.getKeys(),f=/(.+)\.(type|interface|control|element)$/,m;for(var i=0;i<k.length;i++){var g=p.getProperty(k[i]);if(m=g.match(f)){o[m[2]+"s"].push(k[i]);}}}if(b){r();}for(var i=0;i<o.dependencies.length;i++){var d=o.dependencies[i];a.debug("resolve Dependencies to "+d,null,M);if(!this.mLibraries[d]){a.warning("Dependency from "+s+" to "+d+" has not been resolved by library itself",null,M);this.loadLibrary(d);}}var e=o.controls.concat(o.elements);for(var i=0;i<e.length;i++){sap.ui.lazyRequire(e[i],"new extend");}this.includeLibraryTheme(s);o.sName=o.name;o.aControls=o.controls;if(!jQuery.sap.isDeclared(s+".library")){a.warning("Library Module "+s+".library"+" not loaded automatically",null,M);jQuery.sap.require(s+".library");}};
sap.ui.core.Core.prototype.includeLibraryTheme=function(l,v){if((l!="sap.ui.legacy")&&(l!="sap.ui.classic")){if(!v){v="";}var r=(this.oConfiguration.getRTL()?"-RTL":"");var s,a=l+(v.length>0?"-["+v+"]":v);if(l&&l.indexOf(":")==-1){s="library"+v+r;}else{s=l.substring(l.indexOf(":")+1)+v;l=l.substring(0,l.indexOf(":"));}var c=this._getThemePath(l,this.sTheme)+s+".css";jQuery.sap.log.info("Including "+c+" -  sap.ui.core.Core.includeLibraryTheme()");jQuery.sap.includeStyleSheet(c,"sap-ui-theme-"+a);}};
sap.ui.core.Core.prototype.getLoadedLibraries=function(){return jQuery.extend({},this.mLibraries);};
sap.ui.core.Core.prototype.setRoot=function(d,c){if(c){c.placeAt(d,"only");}};
sap.ui.core.Core.prototype.createUIArea=function(d){if(!d){throw new Error("oDomRef must not be null");}if(typeof(d)==="string"){var i=d;d=jQuery.sap.domById(d);if(!d){throw new Error("DOM element with ID '"+i+"' not found in page, but application tries to insert content.");}}if(!d.id||d.id.length==0){d.id=jQuery.sap.uid();}var s=d.id;if(!this.mUIAreas[s]){this.mUIAreas[s]=new sap.ui.core.UIArea(this,d);}else{this.mUIAreas[s].setRootNode(d);}return this.mUIAreas[s];};
sap.ui.core.Core.prototype.getUIArea=function(o){var i="";if(typeof(o)=="string"){i=o;}else{i=o.id;}if(i){return this.mUIAreas[i];}return null;};
sap.ui.core.Core.prototype.addInvalidatedUIArea=function(u){this.rerenderAllUIAreas();};
sap.ui.core.Core.prototype.getLibraryResourceBundle=function(l,s){l=l||"sap.ui.core";s=s||this.getConfiguration().getLanguage();var k=l+"/"+s;if(!this.mResourceBundles[k]){var u=sap.ui.resource(l,'messagebundle.properties');this.mResourceBundles[k]=jQuery.sap.resources({url:u,locale:s});}return this.mResourceBundles[k];};
sap.ui.core.Core.prototype.rerenderAllUIAreas=function(){if(!this._sRerenderTimer){jQuery.sap.log.info("registering timer for delayed re-rendering");this._sRerenderTimer=jQuery.sap.delayedCall(0,this,"_rerenderAllUIAreas");}};
sap.ui.core.Core.prototype._rerenderAllUIAreas=function(){if(this._sRerenderTimer){jQuery.sap.clearDelayedCall(this._sRerenderTimer);this._sRerenderTimer=undefined;}var u=false;var m=this.mUIAreas;for(var i in m){u=m[i].rerender()||u;}if(u){this.fireUIUpdated();}};
sap.ui.core.Core.prototype.getUIDirty=function(){return!!this._sRerenderTimer;};
sap.ui.core.Core.prototype.attachUIUpdated=function(f,l){this.attachEvent(sap.ui.core.Core.M_EVENTS.UIUpdated,f,l);};
sap.ui.core.Core.prototype.detachUIUpdated=function(f,l){this.detachEvent(sap.ui.core.Core.M_EVENTS.UIUpdated,f,l);};
sap.ui.core.Core.prototype.fireUIUpdated=function(p){this.fireEvent(sap.ui.core.Core.M_EVENTS.UIUpdated,p);};
sap.ui.core.Core.prototype.attachThemeChanged=function(f,l){this.attachEvent(sap.ui.core.Core.M_EVENTS.ThemeChanged,f,l);};
sap.ui.core.Core.prototype.detachThemeChanged=function(f,l){this.detachEvent(sap.ui.core.Core.M_EVENTS.ThemeChanged,f,l);};
sap.ui.core.Core.prototype.fireThemeChanged=function(p){jQuery.sap.scrollbarSize(true);var e=sap.ui.core.Core.M_EVENTS.ThemeChanged;var o=jQuery.Event(e);jQuery.each(this.mElements,function(i,a){a._handleEvent(o);});this.fireEvent(e,p);};
sap.ui.core.Core.prototype.applyChanges=function(){this._rerenderAllUIAreas();};
sap.ui.core.Core.prototype.registerElement=function(e){var o=this.byId(e.getId());if(o&&o!==e){if(this.oConfiguration.getNoDuplicateIds()){jQuery.sap.log.error("adding element with duplicate id '"+e.getId()+"'");throw new Error("Error: adding element with duplicate id '"+e.getId()+"'");}else{jQuery.sap.log.warning("adding element with duplicate id '"+e.getId()+"'");}}this.mElements[e.getId()]=e;};
sap.ui.core.Core.prototype.deregisterElement=function(e){delete this.mElements[e.getId()];};
sap.ui.core.Core.prototype.byId=function(i){return i==null?undefined:this.mElements[i];};
sap.ui.core.Core.prototype.getControl=sap.ui.core.Core.prototype.byId;sap.ui.core.Core.prototype.getElementById=sap.ui.core.Core.prototype.byId;
sap.ui.core.Core.prototype.getStaticAreaRef=function(){var s="sap-ui-static";var o=jQuery.sap.domById(s);if(!o){var l=this.getConfiguration().getRTL()?"right":"left";o=jQuery("<DIV/>",{id:s}).css("visibility","hidden").css("height","0").css("width","0").css("overflow","hidden").css("float",l).prependTo(document.body)[0];this.createUIArea(o).bInitial=false;}return o;};
sap.ui.core.Core.prototype.attachControlEvent=function(f,l){this.attachEvent(sap.ui.core.UIArea.M_EVENTS.ControlEvent,f,l);};
sap.ui.core.Core.prototype.detachControlEvent=function(f,l){this.detachEvent(sap.ui.core.UIArea.M_EVENTS.ControlEvent,f,l);};
sap.ui.core.Core.prototype.fireControlEvent=function(p){this.fireEvent(sap.ui.core.UIArea.M_EVENTS.ControlEvent,p);};
sap.ui.core.Core.prototype._handleControlEvent=function(e,u){var o=jQuery.Event(e.type);jQuery.extend(o,e);o.originalEvent=undefined;this.fireControlEvent({"browserEvent":o,"uiArea":u});};
sap.ui.core.Core.prototype.registerPlugin=function(p){if(!p){return;}for(var i=0,l=this.aPlugins.length;i<l;i++){if(this.aPlugins[i]===p){return;}}this.aPlugins.push(p);if(this.bInitialized&&p&&p.startPlugin){p.startPlugin(this);}};
sap.ui.core.Core.prototype.unregisterPlugin=function(p){if(!p){return;}var a=-1;for(var i=this.aPlugins.length;i--;i>=0){if(this.aPlugins[i]===p){a=i;break;}}if(a==-1){return;}if(this.bInitialized&&p&&p.stopPlugin){p.stopPlugin(this);}this.aPlugins.splice(a,1);};
sap.ui.core.Core.prototype.startPlugins=function(){for(var i=0,l=this.aPlugins.length;i<l;i++){var p=this.aPlugins[i];if(p&&p.startPlugin){p.startPlugin(this,true);}}};
sap.ui.core.Core.prototype.stopPlugins=function(){for(var i=0,l=this.aPlugins.length;i<l;i++){var p=this.aPlugins[i];if(p&&p.stopPlugin){p.stopPlugin(this);}}};
sap.ui.core.Core.prototype.setModel=function(m,n){this.oModels[n]=m;jQuery.each(this.mUIAreas,function(i,u){u.updateBindings(n);});};
sap.ui.core.Core.prototype.getModel=function(n){return this.oModels[n];};
sap.ui.core.Core.prototype.hasModel=function(){if(!jQuery.isEmptyObject(this.oModels)){return true;}else{return false;}};
sap.ui.core.Core.prototype.attachValidationError=function(f,l){this.attachEvent(sap.ui.core.Core.M_EVENTS.ValidationError,f,l);return this;};
sap.ui.core.Core.prototype.detachValidationError=function(f,l){this.detachEvent(sap.ui.core.Core.M_EVENTS.ValidationError,f,l);return this;};
sap.ui.core.Core.prototype.attachParseError=function(f,l){this.attachEvent(sap.ui.core.Core.M_EVENTS.ParseError,f,l);return this;};
sap.ui.core.Core.prototype.detachParseError=function(f,l){this.detachEvent(sap.ui.core.Core.M_EVENTS.ParseError,f,l);return this;};
sap.ui.core.Core.prototype.attachFormatError=function(f,l){this.attachEvent(sap.ui.core.Core.M_EVENTS.FormatError,f,l);return this;};
sap.ui.core.Core.prototype.detachFormatError=function(f,l){this.detachEvent(sap.ui.core.Core.M_EVENTS.FormatError,f,l);return this;};
sap.ui.core.Core.prototype.attachValidationSuccess=function(f,l){this.attachEvent(sap.ui.core.Core.M_EVENTS.ValidationSuccess,f,l);return this;};
sap.ui.core.Core.prototype.detachValidationSuccess=function(f,l){this.detachEvent(sap.ui.core.Core.M_EVENTS.ValidationSuccess,f,l);return this;};
sap.ui.core.Core.prototype.fireParseError=function(a){this.fireEvent(sap.ui.core.Core.M_EVENTS.ParseError,a);return this;};
sap.ui.core.Core.prototype.fireValidationError=function(a){this.fireEvent(sap.ui.core.Core.M_EVENTS.ValidationError,a);return this;};
sap.ui.core.Core.prototype.fireFormatError=function(a){this.fireEvent(sap.ui.core.Core.M_EVENTS.FormatError,a);return this;};
sap.ui.core.Core.prototype.fireValidationSuccess=function(a){this.fireEvent(sap.ui.core.Core.M_EVENTS.ValidationSuccess,a);return this;};
sap.ui.core.Core.prototype.isMobile=function(){return!!window.orientation;};
if(!window.sap.ui.getCore){(function(){new sap.ui.core.Core();}());}
sap.ui.setRoot=function(d,c){sap.ui.getCore().setRoot(d,c);};
