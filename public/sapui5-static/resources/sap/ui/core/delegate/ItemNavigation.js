/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.core.delegate.ItemNavigation");jQuery.sap.require("sap.ui.base.EventProvider");
sap.ui.core.delegate.ItemNavigation=function(d,i,n){sap.ui.base.EventProvider.apply(this);this.oDomRef=null;if(d){this.setRootDomRef(d);}this.aItemDomRefs=[];if(i){this.setItemDomRefs(i);}this.iTabIndex=-1;this.iActiveTabIndex=!!n?-1:0;this.iFocusedIndex=-1;this.iSelectedIndex=-1;this.bCycling=true;this.bTableMode=false;this.iPageSize=-1;this._bMouseDownHappened=false;};
sap.ui.core.delegate.ItemNavigation.prototype=jQuery.sap.newObject(sap.ui.base.EventProvider.prototype);sap.ui.base.Object.defineClass("sap.ui.core.delegate.ItemNavigation",{baseType:"sap.ui.base.EventProvider",publicMethods:[]});sap.ui.core.delegate.ItemNavigation.Events={BeforeFocus:"BeforeFocus",AfterFocus:"AfterFocus"};
sap.ui.core.delegate.ItemNavigation.prototype.setRootDomRef=function(d){this.oDomRef=d;if(this.iFocusedIndex>=0){jQuery(this.oDomRef).attr("tabIndex",this.iTabIndex);}else{jQuery(this.oDomRef).attr("tabIndex",this.iActiveTabIndex);}return this;};
sap.ui.core.delegate.ItemNavigation.prototype.getRootDomRef=function(){return this.oDomRef;};
sap.ui.core.delegate.ItemNavigation.prototype.getItemDomRefs=function(){return this.aItemDomRefs;};
sap.ui.core.delegate.ItemNavigation.prototype.setItemDomRefs=function(a){this.aItemDomRefs=a;for(var i=0;i<this.aItemDomRefs.length;i++){if(this.aItemDomRefs[i]){if(i==this.iFocusedIndex){jQuery(this.aItemDomRefs[i]).attr("tabIndex",this.iActiveTabIndex);}else{jQuery(this.aItemDomRefs[i]).attr("tabIndex",-1);}}}return this;};
sap.ui.core.delegate.ItemNavigation.prototype.destroy=function(){this.oDomRef=null;this.aItemDomRefs=null;};
sap.ui.core.delegate.ItemNavigation.prototype.setCycling=function(c){this.bCycling=c;return this;};
sap.ui.core.delegate.ItemNavigation.prototype.setTableMode=function(t){this.bTableMode=t;return this;};
sap.ui.core.delegate.ItemNavigation.prototype.setPageSize=function(p){this.iPageSize=p;return this;};
sap.ui.core.delegate.ItemNavigation.prototype.setSelectedIndex=function(i){this.iSelectedIndex=i;return this;};
sap.ui.core.delegate.ItemNavigation.prototype.setColumns=function(c){this.iColumns=c;return this;};
sap.ui.core.delegate.ItemNavigation.prototype.focusItem=function(i,e){jQuery.sap.log.info('FocusItem: '+i+' iFocusedIndex: '+this.iFocusedIndex);if(i==this.iFocusedIndex&&this.aItemDomRefs[this.iFocusedIndex]==document.activeElement){return;}if(!this.aItemDomRefs[i]){return;}this.fireEvent(sap.ui.core.delegate.ItemNavigation.Events.BeforeFocus,{index:i,event:e});this.setFocusedIndex(i);this.bISetFocus=true;jQuery.sap.focus(this.aItemDomRefs[this.iFocusedIndex]);this.fireEvent(sap.ui.core.delegate.ItemNavigation.Events.AfterFocus,{index:i,event:e});};
sap.ui.core.delegate.ItemNavigation.prototype.setFocusedIndex=function(i){if(i<0){i=0;}if(i>this.aItemDomRefs.length-1){i=this.aItemDomRefs.length-1;}jQuery(this.oDomRef).attr("tabIndex",this.iTabIndex);if(this.iFocusedIndex!==-1&&this.aItemDomRefs.length>this.iFocusedIndex){jQuery(this.aItemDomRefs[this.iFocusedIndex]).attr("tabIndex",-1);}this.iFocusedIndex=i;var f=this.aItemDomRefs[this.iFocusedIndex];jQuery(f).attr("tabIndex",this.iActiveTabIndex);return this;};
sap.ui.core.delegate.ItemNavigation.prototype.getFocusedDomRef=function(){return this.aItemDomRefs[this.iFocusedIndex];};
sap.ui.core.delegate.ItemNavigation.prototype.getFocusedIndex=function(){return this.iFocusedIndex;};
sap.ui.core.delegate.ItemNavigation.prototype.onfocusin=function(e){var s=e.target;if(s==this.oDomRef){if(this._bMouseDownHappened){return;}this.focusItem(this.iSelectedIndex!=-1?this.iSelectedIndex:(this.iFocusedIndex!=-1?this.iFocusedIndex:0),e);e.preventDefault();e.stopPropagation();}else if(!this.bISetFocus){this.fireEvent(sap.ui.core.delegate.ItemNavigation.Events.AfterFocus,{index:this.iFocusedIndex,event:e});}this.bISetFocus=false;};
sap.ui.core.delegate.ItemNavigation.prototype.onsapfocusleave=function(e){if(!e.relatedControlId||!jQuery.sap.containsOrEquals(this.oDomRef,sap.ui.getCore().byId(e.relatedControlId).getFocusDomRef())){this.setFocusedIndex(this.iSelectedIndex!=-1?this.iSelectedIndex:(this.iFocusedIndex!=-1?this.iFocusedIndex:0));}};
sap.ui.core.delegate.ItemNavigation.prototype.onmousedown=function(e){var s=e.target;if(jQuery.sap.containsOrEquals(this.oDomRef,s)){for(var i=0;i<this.aItemDomRefs.length;i++){var o=this.aItemDomRefs[i];if(jQuery.sap.containsOrEquals(o,s)){if(!this.bTableMode){this.focusItem(i,e);e.preventDefault();}else{if(o===s||!jQuery(s).is(":focusable")){this.focusItem(i,e);}}return;}}if(s==this.oDomRef){this._bMouseDownHappened=true;var t=this;window.setTimeout(function(){t._bMouseDownHappened=false;},20);}}};
sap.ui.core.delegate.ItemNavigation.prototype.onsapnext=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)){return;}if(this.bTableMode&&jQuery.inArray(e.target,this.aItemDomRefs)===-1){return;}var i=this.iFocusedIndex;var f=true;if(i>-1){if(this.bTableMode){var r=this.aItemDomRefs.length/this.iColumns;var a=Math.floor(i/this.iColumns);var c=i%this.iColumns;if(e.keyCode==jQuery.sap.KeyCodes.ARROW_DOWN){if(a<r-1){i+=this.iColumns;}}else{if(c<this.iColumns-1){i+=1;}}}else{do{if(this.iColumns>1&&e.keyCode==jQuery.sap.KeyCodes.ARROW_DOWN){if((i+this.iColumns)>=this.aItemDomRefs.length){if((i%this.iColumns)<(this.iColumns-1)){i=(i%this.iColumns)+1;}else if(this.bCycling){i=0;}}else{i=i+this.iColumns;}}else{if(i==this.aItemDomRefs.length-1){if(this.bCycling){i=0;}}else{i++;}}if(i==this.iFocusedIndex){if(f){f=false;}else{throw new Error("ItemNavigation has no visible/existing items and is hence unable to select the next one");}}}while(!this.aItemDomRefs[i]||!jQuery(this.aItemDomRefs[i]).is(":visible")||jQuery(this.aItemDomRefs[i]).css('visibility')=='hidden');}this.focusItem(i,e);e.preventDefault();e.stopPropagation();}};
sap.ui.core.delegate.ItemNavigation.prototype.onsapnextmodifiers=sap.ui.core.delegate.ItemNavigation.prototype.onsapnext;
sap.ui.core.delegate.ItemNavigation.prototype.onsapprevious=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)){return;}if(this.bTableMode&&jQuery.inArray(e.target,this.aItemDomRefs)===-1){return;}var i=this.iFocusedIndex;var f=true;if(i>-1){if(this.bTableMode){var r=this.aItemDomRefs.length/this.iColumns;var a=Math.floor(i/this.iColumns);var c=i%this.iColumns;if(e.keyCode==jQuery.sap.KeyCodes.ARROW_UP){if(a>0){i-=this.iColumns;}}else{if(c>0){i-=1;}}}else{do{if(this.iColumns>1&&e.keyCode==jQuery.sap.KeyCodes.ARROW_UP){if((i-this.iColumns)<0){var c=0;if((i%this.iColumns)>0){c=(i%this.iColumns)-1;}else if(this.bCycling){c=this.iColumns-1;}if(i===0&&c===0){i=0;}else{var b=Math.ceil(this.aItemDomRefs.length/this.iColumns);i=c+((b-1)*this.iColumns);if(i>=this.aItemDomRefs.length){i=i-this.iColumns;}}}else{i=i-this.iColumns;}}else{if(i==0){if(this.bCycling){i=this.aItemDomRefs.length;}}else{i--;}}if(i==this.iFocusedIndex){if(f){f=false;}else{throw new Error("ItemNavigation has no visible/existing items and is hence unable to select the previous one");}}}while(!this.aItemDomRefs[i]||!jQuery(this.aItemDomRefs[i]).is(":visible")||jQuery(this.aItemDomRefs[i]).css('visibility')=='hidden');}this.focusItem(i,e);e.preventDefault();e.stopPropagation();}};
sap.ui.core.delegate.ItemNavigation.prototype.onsappreviousmodifiers=sap.ui.core.delegate.ItemNavigation.prototype.onsapprevious;
sap.ui.core.delegate.ItemNavigation.prototype.onsappageup=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)){return;}if(this.bTableMode&&jQuery.inArray(e.target,this.aItemDomRefs)===-1){return;}if(this.iPageSize>0){var i=this.iFocusedIndex;if(i>-1){i=i-this.iPageSize;if(i<0){i=0;}this.focusItem(i,e);}}else if(this.bTableMode){var c=this.iFocusedIndex%this.iColumns;i=c;this.focusItem(i,e);}e.preventDefault();e.stopPropagation();};
sap.ui.core.delegate.ItemNavigation.prototype.onsappagedown=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)){return;}if(this.bTableMode&&jQuery.inArray(e.target,this.aItemDomRefs)===-1){return;}if(this.bTableMode){var r=this.aItemDomRefs.length/this.iColumns;var c=this.iFocusedIndex%this.iColumns;i=(r-1)*this.iColumns+c;this.focusItem(i,e);}else{if(this.iPageSize>0){var i=this.iFocusedIndex;if(i>-1){i=i+this.iPageSize;if(i>this.aItemDomRefs.length-1){i=this.aItemDomRefs.length-1;}this.focusItem(i,e);}}}e.preventDefault();e.stopPropagation();};
sap.ui.core.delegate.ItemNavigation.prototype.onsaphome=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)||e.shiftKey||e.altKey){return;}if(this.bTableMode&&jQuery.inArray(e.target,this.aItemDomRefs)===-1){return;}var i=0;if(this.bTableMode){if(!(e.metaKey||e.ctrlKey)){var r=this.aItemDomRefs.length/this.iColumns;var a=Math.floor(this.iFocusedIndex/this.iColumns);i=a*this.iColumns;}}else{if(!!(e.metaKey||e.ctrlKey)){return;}while(!this.aItemDomRefs[i]||!jQuery(this.aItemDomRefs[i]).is(":visible")||jQuery(this.aItemDomRefs[i]).css('visibility')=='hidden'){i++;if(i==this.aItemDomRefs.length){return;}}}this.focusItem(i,e);e.preventDefault();e.stopPropagation();};
sap.ui.core.delegate.ItemNavigation.prototype.onsaphomemodifiers=sap.ui.core.delegate.ItemNavigation.prototype.onsaphome;
sap.ui.core.delegate.ItemNavigation.prototype.onsapend=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)||e.shiftKey||e.altKey){return;}if(this.bTableMode&&jQuery.inArray(e.target,this.aItemDomRefs)===-1){return;}var i=this.aItemDomRefs.length-1;if(this.bTableMode){if(!(e.metaKey||e.ctrlKey)){var r=this.aItemDomRefs.length/this.iColumns;var a=Math.floor(this.iFocusedIndex/this.iColumns);i=a*this.iColumns+this.iColumns-1;}}else{if(!!(e.metaKey||e.ctrlKey)){return;}while(!this.aItemDomRefs[i]||!jQuery(this.aItemDomRefs[i]).is(":visible")||jQuery(this.aItemDomRefs[i]).css('visibility')=='hidden'){i--;if(i<0){return;}}}this.focusItem(i,e);e.preventDefault();e.stopPropagation();};
sap.ui.core.delegate.ItemNavigation.prototype.onsapendmodifiers=sap.ui.core.delegate.ItemNavigation.prototype.onsapend;
sap.ui.core.delegate.ItemNavigation.prototype.setTabIndex0=function(){this.iTabIndex=0;this.iActiveTabIndex=0;};
