/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.table.Column");jQuery.sap.require("sap.ui.table.library");jQuery.sap.require("sap.ui.core.Element");sap.ui.core.Element.extend("sap.ui.table.Column",{metadata:{publicMethods:["sort","toggleSort"],library:"sap.ui.table",properties:{"width":{type:"sap.ui.core.CSSSize",group:"",defaultValue:null},"flexible":{type:"boolean",group:"",defaultValue:null},"resizable":{type:"boolean",group:"",defaultValue:true},"hAlign":{type:"sap.ui.commons.layout.HAlign",group:"",defaultValue:sap.ui.commons.layout.HAlign.Begin},"sortProperty":{type:"string",group:"",defaultValue:null},"filterProperty":{type:"string",group:"",defaultValue:null},"filterOperator":{type:"string",group:"",defaultValue:'Contains'}},defaultAggregation:"label",aggregations:{"label":{type:"sap.ui.core.Control",multiple:false},"template":{type:"sap.ui.core.Control",multiple:false}}}});jQuery.sap.require("sap.ui.core.RenderManager");jQuery.sap.require("sap.ui.model.Filter");jQuery.sap.require("sap.ui.model.Sorter");jQuery.sap.require("sap.ui.commons.Image");jQuery.sap.require("sap.ui.commons.Label");jQuery.sap.require("sap.ui.commons.Menu");jQuery.sap.require("sap.ui.commons.MenuItem");jQuery.sap.require("sap.ui.commons.TextField");
sap.ui.table.Column.prototype.init=function(){this.oResBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.table");};
sap.ui.table.Column.prototype.exit=function(){if(this.oMenu){this.oMenu.destroy();}};
sap.ui.table.Column.prototype.onThemeChanged=function(){if(this.oMenu){var c=sap.ui.getCore().getConfiguration().getTheme();var o=sap.ui.getCore().byId(this.getId()+"_asc");if(o){o.setIcon(sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_sort_asc.gif"));}var o=sap.ui.getCore().byId(this.getId()+"_desc");if(o){o.setIcon(sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_sort_desc.gif"));}var o=sap.ui.getCore().byId(this.getId()+"_filter");if(o){o.setIcon(sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_filter.gif"));}}};
sap.ui.table.Column.prototype.setLabel=function(l){var o=l;if(typeof(l)==="string"){o=new sap.ui.commons.Label({text:l});}this.setAggregation("label",o);return this;};
sap.ui.table.Column.prototype.setTemplate=function(t){var o=t;if(typeof(t)==="string"){o=new sap.ui.commons.TextView().bindText(t);}this.setAggregation("template",o);return this;};
sap.ui.table.Column.prototype._openMenu=function(){if(!this.oMenu){this.oMenu=new sap.ui.commons.Menu();var t=this;if(jQuery.browser.msie&&jQuery.browser.version<9){this.oMenu.getPopup().attachClosed(function(o){setTimeout(function(){t.focus();},0);});}var c=sap.ui.getCore().getConfiguration().getTheme();if(this.getSortProperty()){this.oMenu.addItem(new sap.ui.commons.MenuItem(this.getId()+"_asc",{text:this.oResBundle.getText("TBL_SORT_ASC"),icon:sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_sort_asc.gif"),select:function(o){t._onSort(o)}}));this.oMenu.addItem(new sap.ui.commons.MenuItem(this.getId()+"_desc",{text:this.oResBundle.getText("TBL_SORT_DESC"),icon:sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_sort_desc.gif"),select:function(o){t._onSort(o)}}));}if(this.getFilterProperty()){try{jQuery.sap.require("sap.ui.dev.MenuInputItem");if(sap.ui.dev&&sap.ui.dev.MenuInputItem){this.oMenu.addItem(new sap.ui.dev.MenuInputItem(this.getId()+"_filter",{text:this.oResBundle.getText("TBL_FILTER"),icon:sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_filter.gif"),select:function(o){t._onFilter(o)}}));}}catch(e){jQuery.sap.log.warning("The filter feature is not working since sap.ui.dev library is not available.");}}}if(this.oMenu.getItems().length>0){var a=sap.ui.core.Popup.Dock;this.oMenu.open(false,this.getFocusDomRef(),a.BeginTop,a.BeginBottom,this.getDomRef());}};
sap.ui.table.Column.prototype._onSort=function(e){var i=e.getParameter("item");var d=(i.getId().indexOf('_asc')==-1);this.sort(d);};
sap.ui.table.Column.prototype.toggleSort=function(d){if(this.oSorter){this.sort(!this.oSorter.bDescending);}else{this.sort();}};
sap.ui.table.Column.prototype.sort=function(d){var c=this.getParent().getColumns();for(var i=0,l=c.length;i<l;i++){c[i].oSorter=undefined;}this.oSorter=new sap.ui.model.Sorter(this.getSortProperty(),d);this.getParent().getBinding("rows").sort(this.oSorter);this._renderSortIcon(d);return this;};
sap.ui.table.Column.prototype._renderSortIcon=function(d){var c=sap.ui.getCore().getConfiguration().getTheme();var i=sap.ui.getCore().byId(this.getId()+"-sortIcon")||new sap.ui.commons.Image(this.getId()+"-sortIcon");i.addStyleClass("sapUiTblColIconsOrder");if(!d){i.setSrc(sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_sort_asc.gif"));}else{i.setSrc(sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_sort_desc.gif"));}var r=new sap.ui.core.RenderManager();var h=r.getHTML(i);jQuery.sap.byId(this.getParent().getId()).find(".sapUiTblColIconsOrder").remove();jQuery.sap.byId(this.getParent().getId()).find("th").removeAttr("aria-sort");jQuery(h).prependTo(jQuery.sap.domById(this.getParent().getId()+"_icons_"+this.getId()));this.$().attr("aria-sort",d?"descending":"ascending");};
sap.ui.table.Column.prototype._onFilter=function(e){var i=e.getParameter("item");this.filter(i.getValue());};
sap.ui.table.Column.prototype.filter=function(v){if(v){var f=sap.ui.model.FilterOperator[this.getFilterOperator()]||sap.ui.model.FilterOperator.Contains;var a=v;if(this.getParent().isBound()){var t=this.getParent();var s=typeof t.getModel().getProperty(this.getFilterProperty(),t.getContextByIndex(t.getFirstVisibleRow()));if(s==="boolean"){a=a=="true";}else if(s==="int"){a=parseInt(a,10);}else if(s==="float"){a=parseFloat(a);}}this.oFilter=new sap.ui.model.Filter(this.getFilterProperty(),f,a);}else{this.oFilter=undefined;}var b=[];var c=this.getParent().getColumns();for(var i=0,l=c.length;i<l;i++){if(c[i].oFilter){b.push(c[i].oFilter);}}this.getParent().getBinding("rows").filter(b);this._renderFilterIcon(v);return this;};
sap.ui.table.Column.prototype._renderFilterIcon=function(h){var c=sap.ui.getCore().getConfiguration().getTheme();var i=sap.ui.getCore().byId(this.getId()+"-filterIcon")||new sap.ui.commons.Image(this.getId()+"-filterIcon");jQuery.sap.byId(i.getId()).remove();i.addStyleClass("sapUiTblColIconsFilter");if(h){i.setSrc(sap.ui.resource("sap.ui.table","themes/"+c+"/img/ico12_filter.gif"));var r=new sap.ui.core.RenderManager();var a=r.getHTML(i);jQuery(a).prependTo(jQuery.sap.domById(this.getParent().getId()+"_icons_"+this.getId()));}};
sap.ui.table.Column.prototype._restoreIcons=function(){if(this.oSorter){this._renderSortIcon(this.oSorter.bDescending);}if(this.oFilter){this._renderFilterIcon(true);}};
sap.ui.table.Column.prototype.setResizable=function(f){this.setProperty("resizable",f,true);if(f){this.$().find(".sapUiTblColResize").css("cursor","");}else{this.$().find(".sapUiTblColResize").css("cursor","auto");}return this;};
