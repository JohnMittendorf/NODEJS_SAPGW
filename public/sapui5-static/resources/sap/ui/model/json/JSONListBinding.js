/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.model.json.JSONListBinding");jQuery.sap.require("sap.ui.model.ListBinding");
sap.ui.model.json.JSONListBinding=function(m,p,c,s,f){sap.ui.model.ListBinding.apply(this,arguments);this.oSorter=s;this.aFilters=f;this.update();};
sap.ui.model.json.JSONListBinding.prototype=jQuery.sap.newObject(sap.ui.model.ListBinding.prototype);sap.ui.base.Object.defineClass("sap.ui.model.json.JSONListBinding",{baseType:"sap.ui.model.ListBinding",publicMethods:["getLength"]});
sap.ui.model.json.JSONListBinding.prototype.getContexts=function(a,l){if(!a){a=0;}if(!l){l=Math.min(this.iLength,this.oModel.iSizeLimit);}var e=Math.min(a+l,this.aIndices.length);function b(s){return s.slice(-1)!=="/"?s+"/":s;}var c=[],p=b((this.sPath.indexOf("/")!==0?b(this.oContext||""):"")+this.sPath);for(var i=a;i<e;i++){c.push(p+this.aIndices[i]);}return c;};
sap.ui.model.json.JSONListBinding.prototype.setContext=function(c){if(this.oContext!=c){this.oContext=c;this.update();this._fireChange();}};
sap.ui.model.json.JSONListBinding.prototype.getLength=function(){return this.iLength;};
sap.ui.model.json.JSONListBinding.prototype._getLength=function(){return this.aIndices.length;};
sap.ui.model.json.JSONListBinding.prototype.update=function(){var l=this.oModel._getObject(this.sPath,this.oContext);if(l&&jQuery.isArray(l)){this.oList=l.slice(0);this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength();}else{this.oList=null;this.aIndices=[];this.iLength=0;}};
sap.ui.model.json.JSONListBinding.prototype.checkUpdate=function(){var l=this.oModel._getObject(this.sPath,this.oContext);if(!this.oList||!l||l.length!=this.oList.length){this.update();this._fireChange();}};
sap.ui.model.json.JSONListBinding.prototype.updateIndices=function(){this.aIndices=[];for(var i=0;i<this.oList.length;i++){this.aIndices.push(i);}};
sap.ui.model.json.JSONListBinding.prototype.sort=function(s){if(!s){this.oSorter=null;this.updateIndices();this.applyFilter();}else{this.oSorter=s;this.applySort();}this._fireChange();this._fireSort({sorter:s});};
sap.ui.model.json.JSONListBinding.prototype.applySort=function(){if(!this.oSorter){return;}var t=this,s=[],v;jQuery.each(this.aIndices,function(i,a){v=t.oModel._getObject(t.oSorter.sPath,t.oList[a]);if(typeof v=="string"){v=v.toUpperCase();}s[a]=v;});this.aIndices.sort(function(a,b){var c=s[a],d=s[b],r=0;if(c<d||d==null){r=-1;}if(c>d||c==null){r=1;}if(t.oSorter.bDescending){r=-r;}return r;});};
sap.ui.model.json.JSONListBinding.prototype.filter=function(f){this.updateIndices();if(!f||!jQuery.isArray(f)||f.length==0){this.aFilters=null;this.iLength=this._getLength();}else{this.aFilters=f;this.applyFilter();}this.applySort();this._fireChange();this._fireFilter({filters:f});};
sap.ui.model.json.JSONListBinding.prototype.applyFilter=function(){if(!this.aFilters){return;}var t=this,f={},a,b=[],g=false,c=true;jQuery.each(this.aIndices,function(i,d){c=true;jQuery.each(t.aFilters,function(j,o){a=f[o.sPath];if(!a){a=f[o.sPath]=[];}a.push(o);});jQuery.each(f,function(p,a){var v=t.oModel._getObject(p,t.oList[d]);if(typeof v=="string"){v=v.toUpperCase();}g=false;jQuery.each(a,function(j,o){var e=t.getFilterFunction(o);if(v!=undefined&&e(v)){g=true;return false;}});if(!g){c=false;return false;}});if(c){b.push(d);}});this.aIndices=b;this.iLength=b.length;};
sap.ui.model.json.JSONListBinding.prototype.getFilterFunction=function(f){if(f.fnTest){return f.fnTest;}var v=f.oValue1,o=f.oValue2;if(typeof v=="string"){v=v.toUpperCase();}if(typeof o=="string"){o=o.toUpperCase();}switch(f.sOperator){case"EQ":f.fnTest=function(a){return a==v;};break;case"NE":f.fnTest=function(a){return a!=v;};break;case"LT":f.fnTest=function(a){return a<v;};break;case"LE":f.fnTest=function(a){return a<=v;};break;case"GT":f.fnTest=function(a){return a>v;};break;case"GE":f.fnTest=function(a){return a>=v;};break;case"BT":f.fnTest=function(a){return(a>v)&&(a<o);};break;case"Contains":f.fnTest=function(a){return a.indexOf(v)!=-1;};break;case"StartsWith":f.fnTest=function(a){return a.indexOf(v)==0;};break;case"EndsWith":f.fnTest=function(a){return a.indexOf(v)==a.length-new String(f.oValue1).length;};break;default:f.fnTest=function(a){return true;};}return f.fnTest;};
sap.ui.model.json.JSONListBinding.prototype.getDistinctValues=function(p){var r=[],m={},v,t=this;jQuery.each(this.oList,function(i,c){v=t.oModel.getProperty(p,c);if(!m[v]){m[v]=true;r.push(v);}});return r;};
