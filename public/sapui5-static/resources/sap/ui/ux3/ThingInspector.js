/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.ux3.ThingInspector");jQuery.sap.require("sap.ui.ux3.library");jQuery.sap.require("sap.ui.ux3.Overlay");sap.ui.ux3.Overlay.extend("sap.ui.ux3.ThingInspector",{metadata:{library:"sap.ui.ux3",properties:{"firstTitle":{type:"string",group:"Misc",defaultValue:null},"type":{type:"string",group:"Misc",defaultValue:null},"icon":{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},"secondTitle":{type:"string",group:"Misc",defaultValue:null},"followState":{type:"sap.ui.ux3.FollowActionState",group:"Misc",defaultValue:sap.ui.ux3.FollowActionState.Default},"flagState":{type:"boolean",group:"Misc",defaultValue:false},"favoriteState":{type:"boolean",group:"Misc",defaultValue:false},"favoriteActionEnabled":{type:"boolean",group:"Misc",defaultValue:true},"updateActionEnabled":{type:"boolean",group:"Misc",defaultValue:true},"followActionEnabled":{type:"boolean",group:"Misc",defaultValue:true},"flagActionEnabled":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"actions":{type:"sap.ui.ux3.ThingAction",multiple:true,singularName:"action"},"headerContent":{type:"sap.ui.ux3.ThingGroup",multiple:true,singularName:"headerContent"},"facets":{type:"sap.ui.ux3.NavigationItem",multiple:true,singularName:"facet"},"facetContent":{type:"sap.ui.ux3.ThingGroup",multiple:true,singularName:"facetContent"}},associations:{"selectedFacet":{type:"sap.ui.ux3.NavigationItem",multiple:false}},events:{"actionSelected":{},"facetSelected":{allowPreventDefault:true},"feedSubmit":{}}}});sap.ui.ux3.ThingInspector.M_EVENTS={'actionSelected':'actionSelected','facetSelected':'facetSelected','feedSubmit':'feedSubmit'};jQuery.sap.require("sap.ui.ux3.Overlay");jQuery.sap.require("sap.ui.ux3.Feeder");jQuery.sap.require("sap.ui.core.delegate.ItemNavigation");sap.ui.ux3.ThingInspector.getMetadata()._mHiddenAggregations={"_genericActions":{multiple:true,type:"sap.ui.ux3.ThingAction"},"_actionButtons":{multiple:true,type:"sap.ui.commons.Button"}};
sap.ui.ux3.ThingInspector.prototype.init=function(){sap.ui.ux3.Overlay.prototype.init.apply(this);this._oNavBar=new sap.ui.ux3.NavigationBar();var t=this;this._oNavBar.attachSelect(function(c){var i=c.getParameters().item;if(t.fireFacetSelected({id:i.getId(),key:i.getKey(),item:i})){t.setSelectedFacet(i);}else{c.preventDefault();}});if(!this._oItemNavigation){this._oItemNavigation=new sap.ui.core.delegate.ItemNavigation();this.addDelegate(this._oItemNavigation);}this._prepareGenericActions();this._prepareActionMenus();this._prepareUpdateActionPopup();this._CollectionVisible=false;};
sap.ui.ux3.ThingInspector.prototype.onAfterRendering=function(){var $,f,m,s=jQuery(".sapUiUx3Shell").control();if(s.length){s[0].syncWithCanvasSize(this.getDomRef());}else{jQuery.sap.byId(this.getId()).css("bottom","0px").css("top","0px").css("left","0px").css("right","0px");jQuery(".sapUiUx3TIContent").css("bottom","0px").css("top","0px").css("left","0px").css("right","0px");this.setOpenButtonVisible(false);this.setCloseButtonVisible(false);}jQuery.sap.byId(this.getId()).css("position","fixed");this._setItemNavigation();this._resize=false;this._resizeListenerId=sap.ui.core.ResizeHandler.register(jQuery(".sapUiUx3TIFacetContent")[0],jQuery.proxy(this._onresize,this));this._setTriggerValue();this._onresize();};
sap.ui.ux3.ThingInspector.prototype._onresize=function(e){var w;if(e){w=jQuery(e.target).width();}if(!w){w=jQuery(jQuery(".sapUiUx3TIFacetContent")[0]).width();}if(w<this._triggerValue&&this._resize==false){var f=jQuery(".sapUiUx3TIFacetThingGroup");for(var i=0;i<f.length;i++){jQuery(f[i]).animate({width:"100%"},"fast");}this._resize=true;}else if(w>this._triggerValue&&this._resize==true){var f=jQuery(".sapUiUx3TIFacetThingGroup");for(var i=0;i<f.length;i++){jQuery(f[i]).animate({width:"50%"},"fast");}this._resize=false;}};
sap.ui.ux3.ThingInspector.prototype.onclick=function(e){if(e.target.id===this.getId()+'-toggle-collection'){if(!this._CollectionVisible){var T=jQuery(".sapUiUx3TIContent");jQuery(T[0]).animate({left:"229px"},"200");jQuery.sap.byId(this.getId()+'-toggle-collection').text('>>');this._CollectionVisible=true;}else{var T=jQuery(".sapUiUx3TIContent");jQuery(T[0]).animate({left:"29px"},"200");jQuery.sap.byId(this.getId()+'-toggle-collection').text('<<');this._CollectionVisible=false;}}else{sap.ui.ux3.Overlay.prototype.onclick.apply(this,arguments);}};
sap.ui.ux3.ThingInspector.prototype._hasScrollbar=function(e){return(e.get(0).scrollHeight>e.height());};
sap.ui.ux3.ThingInspector.prototype.exit=function(){this.close();this.destroyAggregation("_genericActions");this._oNavBar.destroy();this._oNavBar=null;this._oUpdatePopup.destroy();this._oUpdatePopup=null;this._oMenu.destroy();this._oMenu=null;};
sap.ui.ux3.ThingInspector.prototype.open=function(i){if(this.getDomRef()){this.rerender();}sap.ui.ux3.Overlay.prototype.open.apply(this,arguments);this._selectDefault();};
sap.ui.ux3.ThingInspector.prototype._getActionButtons=function(){return this.getAggregation("_actionButtons",[]);};
sap.ui.ux3.ThingInspector.prototype._getNavBar=function(){return this._oNavBar;};
sap.ui.ux3.ThingInspector.prototype._attachThingAction=function(a){var t=this;var b=a;a.attachSelect(function(c){t._genericActionSelected(c,b);});};
sap.ui.ux3.ThingInspector.prototype._genericActionSelected=function(e,a){var i=a.getId();i=i.substr(i.indexOf("-")+1);if(a.getId()==this.getId()+"-follow"){if(this.getFollowState()==sap.ui.ux3.FollowActionState.Default){this.setFollowState(sap.ui.ux3.FollowActionState.Follow);this._prepareActionMenus();this.fireActionSelected({id:i,action:a});}else{var b=sap.ui.core.Popup.Dock;this._oMenu.open(false,a.getFocusDomRef(),b.BeginTop,b.BeginBottom,a.getDomRef());}}else if(a.getId()==this.getId()+"-favorite"){this._favoriteActionSelected(e,i);}else if(a.getId()==this.getId()+"-flag"){this._flagActionSelected(e,i);}else if(a.getId()==this.getId()+"-update"){this._updateActionSelected(e,i);}else{this.fireActionSelected({id:i,action:a});}};
sap.ui.ux3.ThingInspector.prototype._selectDefault=function(){var n=this._oNavBar.getItems();if(n.length&&!this._oNavBar.getSelectedItem()){if(!this.getSelectedFacet()){this.setSelectedFacet(n[0])};var i=this._oNavBar.getSelectedItem();var a=sap.ui.getCore().byId(i);this.fireFacetSelected({id:a.getId(),key:a.getKey(),item:a});}};
sap.ui.ux3.ThingInspector.prototype._prepareGenericActions=function(){this._oUpdateAction=new sap.ui.ux3.ThingAction({id:this.getId()+"-update"});this._oUpdateAction.setTooltip(this._getText("TI_UPDATE_ACTION_TOOLTIP"));this.addAggregation("_genericActions",this._oUpdateAction);this._attachThingAction(this._oUpdateAction);this._oFollowAction=new sap.ui.ux3.ThingAction({id:this.getId()+"-follow"});this._oFollowAction.setTooltip(this._getText("TI_FOLLOW_ACTION_TOOLTIP_FOLLOW"));this.addAggregation("_genericActions",this._oFollowAction);this._attachThingAction(this._oFollowAction);this._oFavoriteAction=new sap.ui.ux3.ThingAction({id:this.getId()+"-favorite"});this._oFavoriteAction.setTooltip(this._getText("TI_FAVORITE_ACTION_TOOLTIP"));this.addAggregation("_genericActions",this._oFavoriteAction);this._attachThingAction(this._oFavoriteAction);this._oFlagAction=new sap.ui.ux3.ThingAction({id:this.getId()+"-flag"});this._oFlagAction.setTooltip(this._getText("TI_FLAG_ACTION_TOOLTIP"));this.addAggregation("_genericActions",this._oFlagAction);this._attachThingAction(this._oFlagAction);};
sap.ui.ux3.ThingInspector.prototype._prepareActionMenus=function(){var i=sap.ui.resource("sap.ui.ux3","themes/"+sap.ui.getCore().getConfiguration().getTheme());if(!this._oUnFollowItem){this._oUnFollowItem=new sap.ui.commons.MenuItem({id:this.getId()+"-unfollowState",text:this._getText("TI_FOLLOW_ACTION_MENU_TXT_UNFOLLOW"),icon:i+"/img/menu_unlisten.png"});}if(!this._oHoldItem){this._oHoldItem=new sap.ui.commons.MenuItem({id:this.getId()+"-holdState",text:this._getText("TI_FOLLOW_ACTION_MENU_TXT_HOLD"),icon:i+"/img/menu_hold.png"});}if(!this._oUnHoldItem){this._oUnHoldItem=new sap.ui.commons.MenuItem({id:this.getId()+"-unholdState",text:this._getText("TI_FOLLOW_ACTION_MENU_TXT_UNHOLD"),icon:i+"/img/menu_hold.png"});}if(!this._oMenu){this._oMenu=new sap.ui.commons.Menu({id:this.getId()+"-followActionMenu"});var t=this;this._oMenu.attachItemSelect(function(c){t._followMenuSelected(c);});this._oMenu.addItem(this._oHoldItem);this._oMenu.addItem(this._oUnHoldItem);this._oMenu.addItem(this._oUnFollowItem);}if(this.getFollowState()==sap.ui.ux3.FollowActionState.Default){this._oFollowAction.setTooltip(this._getText("TI_FOLLOW_ACTION_TOOLTIP_FOLLOW"));this._oHoldItem.setVisible(false);this._oUnFollowItem.setVisible(false);this._oUnHoldItem.setVisible(false);}else if(this.getFollowState()==sap.ui.ux3.FollowActionState.Follow){this._oFollowAction.setTooltip(this._getText("TI_FOLLOW_ACTION_TOOLTIP_STOPPAUSE_FOLLOW"));this._oHoldItem.setVisible(true);this._oUnFollowItem.setVisible(true);this._oUnHoldItem.setVisible(false);}else if(this.getFollowState()==sap.ui.ux3.FollowActionState.Hold){this._oFollowAction.setTooltip(this._getText("TI_FOLLOW_ACTION_TOOLTIP_STOPCONTINUE_FOLLOW"));this._oHoldItem.setVisible(false);this._oUnFollowItem.setVisible(true);this._oUnHoldItem.setVisible(true);}this._rerenderGenericThingActions();};
sap.ui.ux3.ThingInspector.prototype._equalColumns=function(){var h=jQuery(".sapUiUx3TIHeader");var f=jQuery(".sapUiUx3TIFacets");var s=jQuery(".sapUiUx3TIContentScrollContainer");f.height(s.get(0).scrollHeight);h.height(s.get(0).scrollHeight);};
sap.ui.ux3.ThingInspector.prototype._getFollowActionMenu=function(){return this._oMenu;};
sap.ui.ux3.ThingInspector.prototype._followMenuSelected=function(e){if(e.getParameters().item.getId()==this.getId()+"-followState"){this.setFollowState(sap.ui.ux3.FollowActionState.Follow);}else if(e.getParameters().item.getId()==this.getId()+"-unfollowState"){this.setFollowState(sap.ui.ux3.FollowActionState.Default);}else if(e.getParameters().item.getId()==this.getId()+"-holdState"){this.setFollowState(sap.ui.ux3.FollowActionState.Hold);}else if(e.getParameters().item.getId()==this.getId()+"-unholdState"){this.setFollowState(sap.ui.ux3.FollowActionState.Follow);}this._prepareActionMenus();var i=this._oFollowAction.getId();i=i.substr(i.indexOf("-")+1);this.fireActionSelected({id:i,action:this._oFollowAction});};
sap.ui.ux3.ThingInspector.prototype._flagActionSelected=function(e,i){if(this.getFlagState()==true){this.setFlagState(false);}else{this.setFlagState(true);}this.fireActionSelected({id:i,action:this._oFlagAction});};
sap.ui.ux3.ThingInspector.prototype._favoriteActionSelected=function(e,i){if(this.getFavoriteState()==true){this.setFavoriteState(false);}else{this.setFavoriteState(true);}this.fireActionSelected({id:i,action:this._oFavoriteAction});};
sap.ui.ux3.ThingInspector.prototype._updateActionSelected=function(e){if(this._oUpdatePopup.isOpen()){this._oUpdatePopup.close()}else{this._oUpdatePopup.setPosition(sap.ui.core.Popup.Dock.BeginBottom,sap.ui.core.Popup.Dock.BeginTop,e.getSource().getDomRef(),"-8 -13","none");this._oUpdatePopup.open();}};
sap.ui.ux3.ThingInspector.prototype._prepareUpdateActionPopup=function(e){this._oUpdatePopup=new sap.ui.ux3.ToolPopup({id:this.getId()+"-UpdateActionPopup"}).addStyleClass("sapUiUx3TIUpdatePopup");var t=this;this._feeder=new sap.ui.ux3.Feeder({id:this.getId()+"-Feeder",type:sap.ui.ux3.FeederType.Comment,thumbnailSrc:this.getIcon(),text:"",submit:function(e){var a=e.getParameter("text");t.fireFeedSubmit({text:a});t._oUpdatePopup.close();}});this._oUpdatePopup.addContent(this._feeder);};
sap.ui.ux3.ThingInspector.prototype._rerenderHeaderContent=function(){var $=jQuery.sap.byId(this.getId()+"-headerContent");if($.length>0){var r=sap.ui.getCore().createRenderManager();sap.ui.ux3.ThingInspectorRenderer.renderHeaderContent(r,this);r.flush($[0]);r.destroy();}};
sap.ui.ux3.ThingInspector.prototype._rerenderGenericThingActions=function(){var c=jQuery.sap.byId(this.getId()+"-genericThingActions");if(c.length>0){var r=sap.ui.getCore().createRenderManager();sap.ui.ux3.ThingInspectorRenderer.renderGenericActions(r,this);r.flush(c[0]);r.destroy();}};
sap.ui.ux3.ThingInspector.prototype._rerenderFacetContent=function(){var $=jQuery.sap.byId(this.getId()+"-facetContent");if($.length>0){var r=sap.ui.getCore().createRenderManager();sap.ui.ux3.ThingInspectorRenderer.renderFacetContent(r,this);r.flush($[0]);r.destroy();this._resize=false;this._setTriggerValue();this._onresize();}};
sap.ui.ux3.ThingInspector.prototype._setTriggerValue=function(){var f,m,$=jQuery.sap.byId(this.getId()+"-facetContent");if($.length>0){f=jQuery(".sapUiUx3TIFacetThingGroup");m=jQuery(f[0]).css("min-width");this._triggerValue=parseInt(m,10)*2;}};
sap.ui.ux3.ThingInspector.prototype._updateThingActionButton=function(t){var b=this.getAggregation("_actionButtons");if(!b){return;}for(var i=0;i<b.length;i++){if(b[i].getId()==(this.getId()+"-"+t.getId()+"Button")){b[i].setText(t.getText());b[i].setEnabled(t.getEnabled());break;}}};
sap.ui.ux3.ThingInspector.prototype._rerenderThingActions=function(){var c=jQuery.sap.byId(this.getId()+"-thingActions");if(c.length>0){var r=sap.ui.getCore().createRenderManager();sap.ui.ux3.ThingInspectorRenderer.renderThingActions(r,this);r.flush(c[0]);r.destroy();}};
sap.ui.ux3.ThingInspector.prototype._setItemNavigation=function(){if(this.getDomRef()){this._oItemNavigation.setRootDomRef(jQuery(this.getDomRef()).find(".sapUiUx3TIToolbar").get(0));var a=[];var o=this.getAggregation("_genericActions",[]);for(var i=0;i<o.length;i++){a.push(o[i].getDomRef());}o=this.getAggregation("_actionButtons",[]);for(var i=0;i<o.length;i++){a.push(o[i].getDomRef());}this._oItemNavigation.setItemDomRefs(a);}};
sap.ui.ux3.ThingInspector.prototype.insertAction=function(a,i){this.insertAggregation("actions",a,i,true);var b=new sap.ui.commons.Button({id:this.getId()+"-"+a.getId()+"Button",text:a.getText(),enabled:a.getEnabled()});var t=this;var c=a;b.attachPress(function(o){var d=o.getSource().getId();var e=d.substr((d.indexOf("-")+1));e=e.substr(0,e.indexOf("Button"));t.fireActionSelected({id:e,action:a});});this.addAggregation("_actionButtons",b,i,true);this._rerenderThingActions();this._setItemNavigation();return this;};
sap.ui.ux3.ThingInspector.prototype.addAction=function(a){this.addAggregation("actions",a,true);var b=new sap.ui.commons.Button({id:this.getId()+"-"+a.getId()+"Button",text:a.getText(),enabled:a.getEnabled()});var t=this;var c=a;b.attachPress(function(o){var i=o.getSource().getId();var d=i.substr((i.indexOf("-")+1));d=d.substr(0,d.indexOf("Button"));t.fireActionSelected({id:d,action:a});});this.addAggregation("_actionButtons",b,true);this._rerenderThingActions();this._setItemNavigation();return this;};
sap.ui.ux3.ThingInspector.prototype.removeAction=function(e){var b=sap.ui.getCore().byId(this.getId()+"-"+e.getId()+"Button");this.removeAggregation("_actionButtons",b,true);b.destroy();var r=this.removeAggregation("actions",e,true);this._rerenderThingActions();this._setItemNavigation();return r;};
sap.ui.ux3.ThingInspector.prototype.removeAllActions=function(){this.destroyAggregation("_actionButtons",true);var r=this.removeAllAggregation("actions",true);this._rerenderThingActions();this._setItemNavigation();return r;};
sap.ui.ux3.ThingInspector.prototype.destroyActions=function(){this.destroyAggregation("_actionButtons",true);this.destroyAggregation("actions",true);this._rerenderThingActions();this._setItemNavigation();return this;};
sap.ui.ux3.ThingInspector.prototype.getFacets=function(){return this._oNavBar.getItems();};
sap.ui.ux3.ThingInspector.prototype.insertFacet=function(f,i){this._oNavBar.insertItem(f,i);return this;};
sap.ui.ux3.ThingInspector.prototype.addFacet=function(f){this._oNavBar.addItem(f);return this;};
sap.ui.ux3.ThingInspector.prototype.removeFacet=function(e){return this._oNavBar.removeItem(e);};
sap.ui.ux3.ThingInspector.prototype.removeAllFacets=function(){return this._oNavBar.removeAllItems();};
sap.ui.ux3.ThingInspector.prototype.destroyFacets=function(){this._oNavBar.destroyItems();return this;};
sap.ui.ux3.ThingInspector.prototype.setFollowState=function(f){var a=jQuery.sap.byId(this.getId()+"-follow");a.removeClass(this.getFollowState()).addClass(f);if(f==sap.ui.ux3.FollowActionState.Default){a.attr("aria-haspopup","false");}else{a.attr("aria-haspopup","true");}this.setProperty("followState",f,true);this._prepareActionMenus();return this;};
sap.ui.ux3.ThingInspector.prototype.setFlagState=function(f){jQuery.sap.byId(this.getId()+"-flag").toggleClass("Selected",f);this.setProperty("flagState",f,true);return this;};
sap.ui.ux3.ThingInspector.prototype.setFavoriteState=function(f){jQuery.sap.byId(this.getId()+"-favorite").toggleClass("Selected",f);this.setProperty("favoriteState",f,true);return this;};
sap.ui.ux3.ThingInspector.prototype.setIcon=function(i){this.setProperty("icon",i);this._feeder.setThumbnailSrc(i);return this;};
sap.ui.ux3.ThingInspector.prototype.insertFacetContent=function(f,i){this.insertAggregation("facetContent",f,i,true);this._rerenderFacetContent();return this;};
sap.ui.ux3.ThingInspector.prototype.addFacetContent=function(f){this.addAggregation("facetContent",f,true);this._rerenderFacetContent();return this;};
sap.ui.ux3.ThingInspector.prototype.removeFacetContent=function(f){var r=this.removeAggregation("facetContent",f,true);this._rerenderFacetContent();return r;};
sap.ui.ux3.ThingInspector.prototype.removeAllFacetContent=function(){var r=this.removeAllAggregation("facetContent",true);this._rerenderFacetContent();return r;};
sap.ui.ux3.ThingInspector.prototype.destroyFacetContent=function(){this.destroyAggregation("facetContent",true);this._rerenderFacetContent();return this;};
sap.ui.ux3.ThingInspector.prototype.insertHeaderContent=function(h,i){this.insertAggregation("headerContent",h,i,true);this._rerenderHeaderContent();return this;};
sap.ui.ux3.ThingInspector.prototype.addHeaderContent=function(h){this.addAggregation("headerContent",h,true);this._rerenderHeaderContent();return this;};
sap.ui.ux3.ThingInspector.prototype.removeHeaderContent=function(h){var r=this.removeAggregation("headerContent",h,true);this._rerenderHeaderContent();return r;};
sap.ui.ux3.ThingInspector.prototype.removeAllHeaderContent=function(){var r=this.removeAllAggregation("headerContent",true);this._rerenderHeaderContent();return r;};
sap.ui.ux3.ThingInspector.prototype.destroyHeaderContent=function(){this.destroyAggregation("headerContent",true);this._rerenderHeaderContent();return this;};
sap.ui.ux3.ThingInspector.prototype.setSelectedFacet=function(s){var o=this.getSelectedFacet();this.setAssociation("selectedFacet",s,true);var n=this.getSelectedFacet();if(o!=n){this._oNavBar.setSelectedItem(n);}};
sap.ui.ux3.ThingInspector.prototype.invalidate=function(o){if(o instanceof sap.ui.ux3.ThingAction){this._updateThingActionButton(o);this._rerenderGenericThingActions();}else{sap.ui.core.Control.prototype.invalidate.apply(this,arguments);}};
